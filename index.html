<!DOCTYPE html>
<html>
<head>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <style>
        body {margin: auto; background: #1f1f1f; color: #ababa6; font-family: "Segoe UI", Roboto, Helvetica, Arial, sans-serif; font-size: 16px; line-height: 1.9; padding-top: 12px; width: 100%;}
        code {background: #0f0e0e;}
		
		button {flex: 1; height: 48px; color: #ababa6; background-color: #0c0c0c; border: none; border-radius: 4px;}
		button:hover {color: #FFF; background-color: #292928;}
		button:active {color: #666; background-color: #0d0d0c;}
		
		#help {max-width: 73%; margin: auto;}
		#video {margin: auto; width: 480px;}
		#player {width: 480px; height: 270px; display: block; padding-bottom: 12px;}
		#buttonHolder {display: flex; padding-left: 12px; padding-right: 12px;}
		
		#back {margin-right: 12px;}
		footer {padding-bottom: 1em;}
		
		a {color: #aaaaa6;}
    </style>
    <title>my-playlist</title>
</head>
<body>
	<button onclick="trySampleRequest();">Try sample request</button>
	
	<div id='help'>
		<h1>my-playlist</h1>
		<p>a minimal youtube playlist controller. copy this url: <code>https://kiwijuice56.github.io/my-playlist/?id=[PLAYLIST_ID]&shuffle=1</code> and replace <code>[PLAYLIST_ID]</code> with the text after <code>list=</code> in your youtube playlist url. remove <code>shuffle=1</code> to disable shuffling. after entering your url, you can play, pause, and skip using keyboard controls or the buttons below the video. you can also bookmark the url to save your settings. enable <code>desktop site</code> on firefox mobile to stop audio from automatically pausing when switching tabs or to allow for video looping. </p>
		<p>zero data is collected from users. this website was made to remove the bloat of the youtube website for playlists and to fix the broken shuffle feature. </p>
		<footer>
			<a href="https://github.com/kiwijuice56">github</a>
		</footer>
	</div>
	<script>
	  var YOUR_CLIENT_ID = '69191214053-g5ojq38n185e9h4tis7afigvva5hh3jv.apps.googleusercontent.com';
	  var YOUR_REDIRECT_URI = 'https://kiwijuice56.github.io/my-playlist/';
	  var fragmentString = location.hash.substring(1);

	  // Parse query string to see if page request is coming from OAuth 2.0 server.
	  var params = {};
	  var regex = /([^&=]+)=([^&]*)/g, m;
	  while (m = regex.exec(fragmentString)) {
		params[decodeURIComponent(m[1])] = decodeURIComponent(m[2]);
	  }
	  if (Object.keys(params).length > 0) {
		localStorage.setItem('oauth2-test-params', JSON.stringify(params) );
		if (params['state'] && params['state'] == 'try_sample_request') {
		  trySampleRequest();
		}
	  }

	  // If there's an access token, try an API request.
	  // Otherwise, start OAuth 2.0 flow.
	  function trySampleRequest() {
		var params = JSON.parse(localStorage.getItem('oauth2-test-params'));
		if (params && params['access_token']) {
		  var xhr = new XMLHttpRequest();
		  xhr.open('GET',
			  'https://www.googleapis.com/youtube/v3/playlists?part=contentDetails&id=PL9ujewBhQLIvJOmZn9lWCyBSaLbDgdqmr' +
			  'access_token=' + params['access_token']);
		  xhr.onreadystatechange = function (e) {
			if (xhr.readyState === 4 && xhr.status === 200) {
			  console.log(xhr.response);
			} else if (xhr.readyState === 4 && xhr.status === 401) {
			  // Token invalid, so prompt for user permission.
			  oauth2SignIn();
			}
		  };
		  xhr.send(null);
		  console.log("success");
		} else {
		  oauth2SignIn();
		}
	  }

	  /*
	   * Create form to request access token from Google's OAuth 2.0 server.
	   */
	  function oauth2SignIn() {
		// Google's OAuth 2.0 endpoint for requesting an access token
		var oauth2Endpoint = 'https://accounts.google.com/o/oauth2/v2/auth';

		// Create element to open OAuth 2.0 endpoint in new window.
		var form = document.createElement('form');
		form.setAttribute('method', 'GET'); // Send as a GET request.
		form.setAttribute('action', oauth2Endpoint);

		// Parameters to pass to OAuth 2.0 endpoint.
		var params = {'client_id': YOUR_CLIENT_ID,
					  'redirect_uri': YOUR_REDIRECT_URI,
					  'scope': 'https://www.googleapis.com/auth/youtube.force-ssl',
					  'state': 'try_sample_request',
					  'include_granted_scopes': 'true',
					  'response_type': 'token'};

		// Add form parameters as hidden input values.
		for (var p in params) {
		  var input = document.createElement('input');
		  input.setAttribute('type', 'hidden');
		  input.setAttribute('name', p);
		  input.setAttribute('value', params[p]);
		  form.appendChild(input);
		}

		// Add form to page and submit it to open the OAuth 2.0 endpoint.
		document.body.appendChild(form);
		form.submit();
	  }
	</script>
</body>
</html>
